Priorities
==========
What name for the library?

Examples
--------
- check canvas availability
- polishing
- catch error in planet when loading from file

Documentation
-------------
- js library (mostly, syntax extension)                  <=====

Libraries
---------
- finish js API
  ===> event callbacks                                   <======
       ==> how can we invoke a previous callback?
  ===> dom object creation (especially, INPUT)
- event handlers:                                        <======
  ==> use a wrapper:
	  if (!e) e = window.event;
          ....
  ==> we want to be able to access this
      (avoid memory leaks...)
  ==> either a function, undefined or null
- canvas: should check whether it is available...
- firebug.ml ==> debugging code
- "createFooElement" a bit heavy

Packaging
---------
- licenses

Benchmarks/examples
===================
- take examples from http://shootout.alioth.debian.org/?
- planets (+satellites?) ===> Runge-Kutta
- 3D effects: http://gyu.que.jp/jscloth/
              http://stackoverflow.com/questions/1584854/how-to-draw-3d-sphere

Design notes
============
- should we rely on automatic conversions for float/string/bool?
  ==> does not always work (for instance, strokeStyle method for canvas)

Known issues
============
- mutually recursive functions in a loop are not correctly compiled:
  should build a shared closure

Compiler optimizations
======================
- fix control.ml

- no need to convert to integer after multiplication or division

- detect caml_format_int("%d", x) and generate ""+x

- multiplication:
    optimization when one argument is known to be small (< 20 bits)
  similarly for div/sub when argument not zero and no overflow
    (not dividing by -1)

- syntactic sugar for Javascript literal strings
  + optimization to avoid going through Caml strings

- turn partial applications into closures?
    x = app(f, x) ====>
    x = fun(x1,...,xn) {return f(x, x1, ...,xn);}

- Can we avoid spurious conversions from boolean to integers???
  ===> explicit conversion to boolean; specialized "if" that operates
       on booleans directly

- inlining (especially of functions that are used only once!)
- constant hoisting (including functions, out of loops and functions)
- inline also partially applied functions

- using continuation with multiples arguments
  ==> graph coloring + variable coalescing
  ==> we should check stack compatibility when parsing:
      when jumping somewhere, the stack should keep the same shape
- remove "Variable x" instruction

- Improved optimizations
  ==> cross-function optimizations
  ==> deadcode elimination inside blocks
  (for instance, elimination of function which are defined in a
   functor but are not used)

- string escape: use \0 instead of \x00

RUNTIME
=======
- caml_lex_engine/caml_new_lex_engine
- caml_parse_engine/caml_set_parser_trace

==========================
==========================

Special case for shortcut boolean operations...

     1
     |\
     | \2
     | /\
     |/  \
     3    4

==========================

MD5
===
http://www.myersdaily.org/joseph/javascript/md5-speed-test.html
http://code.google.com/p/crypto-js/source/browse/trunk/src/Crypto.js
http://bitwiseshiftleft.github.com/sjcl/

Float <-> hex
=============
http://babbage.cs.qc.edu/IEEE-754/js/IEEE-754.js
http://snippets.dzone.com/posts/show/685
http://jsfromhell.com/classes/binary-parser

Filling a string
================
  function stringFill3(x, n) {
    var s = '';
    for (;;) {
      if (n & 1) s += x;
      n >>= 1;
      if (n) x += x;
      else break;
    }
    return s;
  }

Conversion string <-> array
===========================
  http://code.google.com/p/crypto-js/source/browse/trunk/src/Crypto.js


Byte array ==> string
=====================
int array --map--> string array --join--> string
   b[i] = toString[a[i]]  where toString is a precomputed array of strings

Bigint
======
http://www.leemon.com/crypto/BigInt.js

==========================

BUGS
====
- ISINT is compiled to "not a block"; document this deviation
  (or document that we should not rely on the Obj module)

- fix definitions of max_int and min_int in pervasive...
  (not sure how...)

PERFORMANCE
===========
- should we rebind variables from a deeper level ?
  (only if used more than once...)

     var x = ...
     function () {
        var y = x;
        ... y .... y ... y ....
     }

COMPACT MODE
============
- We need to insert newlines from time to time to avoid problems with
  some routers...
- Code for variable renaming in Javascript code
  ==> also eliminate redundant "var"?
- Start with function parameters.  Then, variables that are used most.
- Use interference mechanism...

IMPROVEMENTS
============

- be more cautious regarding how we print floats...
  (is it accurate?)
  ==> gdtoa
    http://caml.inria.fr/pub/ml-archives/caml-list/2002/12/2813f8e8be115b0bad1bc16b1e41b744.en.html

- We only have to make sure we do not use a
  reserved word nor a function used outside for naming variables

- convert boolean to integer: (x)+0
  (is that faster than x?1:0 ?)

- explicit conversion from int to boolean

- simplify conditional definition
  should be:
     Cond of Var.t * cont * cont
  (we need to eliminate unnecessary conversions from bool to integer
   for that)

NEW FEATURES
============

- Map Caml objects to Javascript objects
  ==> remap CamlinternalOO module

- dynamic linking? (code generation from cmo files)

- Can we use the debugger information to generate specialized code?
  (Use objects rather than arrays for tuples, ...)

DATA REPRESENTATION
===================
- should wrap Ocaml exceptions (more robust code)...
  ==> use Error object as base object, special "message" method

DATA ANALYSIS
=============
- interprocedural analysis

COMPRESSION OPTIMIZATION
========================
- http://timepedia.blogspot.com/2009/08/on-reducing-size-of-compressed.html
  http://timepedia.blogspot.com/2009/11/traveling-salesman-problem-and.html
  ==> order functions by similarity
  ==> try to always use the same arguments for functions
  ==> 7-zip is better at compressing than gzip, with the same algorithm...
- we can remove some whitespaces but we have to look at the context...

TYPES
=====

Use 32 bit signed integer (following the spec!)
===> we do not have enough bits for multiplication :-(
===> should probably also have 31 bit as an option, for compatibility...

DOCUMENTATION
=============
document as much as we can:
* the representation of datas, closures, ...
* the assumption we make regarding the bytecode
  ==> ISINT
  ==> special case for ASSIGN
  ==> loops and junctions ==> only the accu may changes (same stack)
      when two paths merge, not even that for loops

================================

REFERENCES
==========

http://blog.higher-order.net/2009/09/08/understanding-clojures-persistenthashmap-deftwice/

http://code.google.com/closure/compiler/

http://code.google.com/p/ocamljs/source/browse/#svn/trunk/src

Inlining: see Manuel Serrano's paper

Resolving and Exploiting the k-CFA Paradox
Illuminating Functional vs. Object-Oriented Program Analysis
Matthew Might               Yannis Smaragdakis             David Van Horn

==================================

Use window.postMessage instead of setTimeout for yield (setTimeout
always waits a bit!)
==> but window.postMessage is synchronous in IE8
    + does not cooperate well with other users of message events

==================================

Could we generate ocaml bytecode as well? (bytecode optimizer)
LLVM code?

Targeting JAVA / .net seem harder: not type information...

==================================

http://www.pps.jussieu.fr/~montela/ocamil/
Note that the OCamIL compilers and tools are currently based on OCaml
v3.06. An upgrade to the latest OCaml version is scheduled for the
next release.
[Never happened...]

ocamldefun (on ocaml_beginners)
I'd really like to play around ocamldefun, but it seems to only work
with ocaml 3.06. Has anyone had luck setting this up in more recent
versions of ocaml?

OCamlexc (on caml list)
So I was wondering if there is any current or recent projects (or interests) 
to resume OCamlExc development and complete the set of handled constructs,
as I'm afraid I'll have neither the time nor the skills to do the job. 

