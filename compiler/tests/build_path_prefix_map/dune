(rule
  (deps source.ml)
  (targets source.cmo)
  (action (run %{bin:ocamlc} -c -g source.ml -o source.cmo)))

(rule
  (deps source.cmo setup-env.sh)
  (targets generated.map)
  (action (run ./setup-env.sh
     %{bin:js_of_ocaml} --source-map --no-runtime --source-map-no-source
    source.cmo -o generated.js)))

(alias
  (name runtest)
  (action (diff expected_map generated.map)))
